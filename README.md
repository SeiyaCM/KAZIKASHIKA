# KAZIKASHIKA
An app for visualizing time spent on domestic chores, child-rearing, and elder care

## 1\. 概要

本ドキュメントは、家事の貢献度を可視化し、家庭内での公平な分担を促進するWebアプリケーション『KAZIKASHIKA』の仕様を定義するものである。
ユーザーは日々の家事を記録し、その貢献度を独自のポイントシステムに基づいてスコア化する。これにより、見えにくかった家事労働を定量的に評価し、メンバー間の相互理解とモチベーション向上を目的とする。

## 2\. ターゲットユーザー

  - **プライマリ**: 家事分担に課題を感じている共働き夫婦・カップル
  - **セカンダリ**:
      - 家族（子供含む）で家事への参加意識を高めたい家庭
      - ルームシェア等、共同生活での家事分担ルールを明確にしたいグループ
      - 一人暮らしで日々の家事に達成感やメリハリをつけたい個人

## 3\. コンセプト

  - **公平な分担サポート**: 家事の「時間」と個人の「心理的負担（ストレス度）」を掛け合わせたポイントで貢献度を可視化し、納得感のある分担をサポートする。
  - **モチベーション向上**: ポイントによるランキング機能で、日々の家事への取り組みをゲーム感覚で楽しめ、継続的なモチベーションを維持する。

## 4\. 収益化モデル（マネタイズ）と料金プラン

本アプリは、基本的な機能を無料で提供する**フリーミアムモデル**を採用する。広告を非表示にし、より高度な分析やモチベーション維持に繋がる機能を提供する有料の「プレミアムプラン」を設ける。

### 4.1. プラン比較

| 機能 | フリープラン | プレミアムプラン |
| :--- | :---: | :---: |
| **利用料金** | 無料 | 月額 XXX円 / 年額 YYYY円 |
| **広告表示** | **あり** | **なし** |
| 基本的な家事記録・管理 | ✅ | ✅ |
| ポイント計算ロジック | ✅ | ✅ |
| リアルタイムランキング | ✅ | ✅ |
| 貢献度グラフ（月間） | ✅ | ✅ |
| **データ閲覧期間** | 直近**30日間** | **期間無制限** |
| **詳細レポート機能** | ❌ | ✅ |
| **目標設定機能** | ❌ | ✅ |

## 5\. 主要機能一覧

  - ユーザー登録とオンボーディング
  - 家事リストの管理（追加・編集）
  - 家事の実行記録
  - ダッシュボード（貢献度グラフ）
  - ランキング表示
  - 広告表示
  - プレミアム機能
      - 詳細レポート
      - 目標設定
  - ポイント計算ロジック

## 6\. 機能詳細仕様

### 6.1. ユーザー登録とオンボーディング (User Onboarding)

`ユーザー`がスムーズにアプリ利用を開始できるように、初期設定のハードルを下げる。

  - **ユーザーストーリー 1: 新規登録**

      - **As a** 新規ユーザー, **I want to** 簡単な手順でアカウントを登録し、パートナーや家族を招待できる, **so that** すぐにチームでアプリを使い始めることができる。

  - **ユーザーストーリー 2: ストレス度の初期設定**

      - **As a** 新規ユーザー, **I want to** いくつかの基本的な家事に対する個人的なストレス度を直感的に設定できる, **so that** アプリを使い始めるための複雑な初期設定をせずに済む。

  - **シナリオ: 新規ユーザーがオンボーディングを完了する**

      - **Given** ユーザーがアプリに初めてアクセスする
      - **When** ユーザーがアカウントを登録し、チームを作成（または参加）する
      - **And** 「かんたん家事ストレス診断」が開始される
      - **Then** システムは predefined な基本家事（「料理」「掃除機がけ」「お風呂掃除」など）を一つずつ提示する
      - **And** ユーザーは各家事に対して、自身のストレス度を5段階（例: `1:楽` 〜 `5:大変`）で選択する
      - **And** すべての基本家事の設定が完了すると、ホーム画面が表示される

### 6.2. 家事リストの管理 (Chore Management)

`ユーザー`が自身の家庭環境に合わせて家事リストを自由にカスタマイズできるようにする。

  - **ユーザーストーリー 1: 新しい家事の追加**

      - **As a** ユーザー, **I want to** 我が家特有の家事をリストに新しく追加できる, **so that** すべての家事を記録・評価の対象にできる。

  - **シナリオ: ユーザーが新しい家事を追加する**

      - **Given** ユーザーが「家事リスト管理」画面を開いている
      - **When** 「新しい家事を追加」ボタンをクリックする
      - **And** 家事の名前（例: 「観葉植物の水やり」）を入力する
      - **And** その家事に対する**自身の**ストレス度（1〜5）を設定して保存する
      - **Then** 新しい家事がチームの家事リストに追加される
      - **And** 他のチームメンバーには、その新しい家事に対するストレス度を設定するよう通知される

### 6.3. 家事の実行記録 (Chore Logging)

`ユーザー`が日々の家事を簡単かつ迅速に記録できるようにする。

  - **ユーザーストーリー 1: 家事の完了報告**

      - **As a** ユーザー, **I want to** 完了した家事とかかった時間を数タップで記録できる, **so that** 面倒さを感じずに日々の家事を継続して記録できる。

  - **シナリオ: ユーザーが完了した家事を記録する**

      - **Given** ユーザーがホーム画面の家事リストを見ている
      - **When** 完了した家事（例: 「お風呂掃除」）の「完了」ボタンをタップする
      - **Then** 「かかった時間は？」というポップアップが表示される
      - **And** 画面には時間の選択肢ボタン（「15分」「30分」「45分」など）と自由入力欄が表示される
      - **When** ユーザーが時間を入力（または選択）して「決定」ボタンをタップする
      - **Then** システムは設定されたポイントを計算し、「お疲れ様でした！XXポイント獲得です！」というフィードバックを表示する
      - **And** ユーザーの合計ポイントが更新される

### 6.4. ダッシュボードとランキング (Dashboard & Ranking)

`ユーザー`が家事の貢献度をひと目で把握し、モチベーションを維持できるようにする。

  - **ユーザーストーリー 1: 貢献度の確認**

      - **As a** ユーザー, **I want to** チーム内での各メンバーの家事貢献度をグラフで確認できる, **so that** 家事分担のバランスを客観的に把握できる。

  - **ユーザーストーリー 2: ランキングの確認**

      - **As a** ユーザー, **I want to** ポイントに基づいたチーム内ランキングを見ることができる, **so that** ゲーム感覚で家事を楽しむモチベーションが湧く。

  - **シナリオ: ユーザーがダッシュボードを確認する**

      - **Given** ユーザーがダッシュボード画面を開いている
      - **When** 期間（「今週」「今月」）を選択する
      - **Then** 選択した期間における各メンバーの合計獲得ポイントの割合が円グラフで表示される
      - **And** メンバーごとのポイント獲得ランキングがリスト形式で表示される
      - **And** ランキングには各メンバーの合計ポイントと順位が表示される

  - **注記:** フリープランのユーザーがダッシュボードやカレンダーで31日以上前のデータにアクセスしようとした場合、「プレミアムプランに登録すると、過去の全データが閲覧できます」といったアップセル用の案内を表示する。

### 6.5. 広告表示 (Ad Display)

`フリープランのユーザー`に対して広告を適切に表示することで、サービスの無料提供を維持する。

  - **ユーザーストーリー: 広告の閲覧**

      - **As a** フリープランのユーザー, **I expect to** アプリ利用中に広告が表示される, **so that** 私は無料でサービスの基本機能を利用することができる。

  - **シナリオ: 広告が表示される**

      - **Given** ユーザーがフリープランを利用している
      - **When** ユーザーがダッシュボード画面を開く、または家事記録を完了するなどの特定のアクションを行う
      - **Then** 画面の指定された領域（例: フッターバナー、画面遷移時のインタースティシャル広告）に広告が表示される

### 6.6. プレミアム機能 (Premium Features)

`プレミアムプランのユーザー`に対して、より高度で便利な機能を提供し、サービスの満足度を高める。

  - **ユーザーストーリー 1: 広告非表示**

      - **As a** プレミアムプランのユーザー, **I want to** アプリを広告なしで利用したい, **so that** 家事の記録や確認に集中でき、より快適な体験を得られる。

  - **ユーザーストーリー 2: 詳細レポート**

      - **As a** プレミアムプランのユーザー, **I want to** 月次や年次での詳細な家事レポートを確認したい, **so that** 家族の家事分担の変遷を振り返ったり、長期的な貢献を称え合ったりできる。
      - **レポート内容の例:**
          - 期間中の総獲得ポイントと、メンバーごとの内訳
          - 最も貢献度の高かった家事カテゴリ
          - 「ありがとう」機能（将来実装時）の送受信回数サマリー

  - **ユーザーストーリー 3: 目標設定**

      - **As a** プレミアムプランのユーザー, **I want to** チームで月間の合計獲得ポイント目標を設定したい, **so that** 「目標を達成したらみんなで外食」のような共通の楽しみを作り、協力して家事に取り組むことができる。

  - **シナリオ: 目標設定機能を利用する**

      - **Given** ユーザーがプレミアムプランに登録している
      - **When** 設定画面から「目標設定」を選択する
      - **And** 月間の目標合計ポイント（例: `3000pt`）と、達成時のご褒美（例: `焼肉に行く！`）を入力して設定する
      - **Then** ダッシュボードやホーム画面に、目標達成度を示すプログレスバーが表示される
      - **And** 目標を達成すると、祝福のメッセージやエフェクトが表示される

## 7\. ポイント計算ロジック

  - **基本計算式**

    ```
    獲得ポイント = 家事の実行時間（分） × 個人設定のストレス度
    ```

  - **変数定義**

      - `家事の実行時間`: ユーザーが自己申告する時間（単位: 分）。`Integer`型。
      - `個人設定のストレス度`: 家事ごと、かつユーザーごとに設定される1〜5の整数値。`Integer`型。

  - **計算例: 「トイレ掃除」を実行した場合**

      - **前提条件:**
        | 項目 | Aさん | Bさん |
        | :--- | :---: | :---: |
        | トイレ掃除のストレス度 | 5 | 2 |
      - **実行記録:**
          - 実行時間: 10分
      - **獲得ポイント:**
          - **もしAさんが実行した場合:** `10分 × ストレス度:5 = 50ポイント`
          - **もしBさんが実行した場合:** `10分 × ストレス度:2 = 20ポイント`

---

## 開発者向けドキュメント

### 技術スタック

#### フロントエンド
- **フレームワーク**: React 18.x + Vite 6.x
- **言語**: TypeScript 5.x
- **UIライブラリ**: Tailwind CSS + shadcn/ui
- **状態管理**: Zustand + TanStack Query
- **API通信**: tRPC

#### バックエンド
- **フレームワーク**: Express 4.x
- **言語**: TypeScript 5.x
- **API**: tRPC 10.x
- **ORM**: Prisma 5.x
- **データベース**: PostgreSQL 15.x (Amazon RDS)
- **認証**: AWS Cognito + aws-jwt-verify

#### インフラ
- **クラウド**: AWS
- **IaC**: AWS CDK
- **ホスティング**: Lambda + API Gateway (Backend) / S3 + CloudFront (Frontend)

#### 開発ツール
- **パッケージマネージャー**: npm
- **Linter/Formatter**: Biome
- **テスト**: Vitest
- **CI/CD**: GitHub Actions

### プロジェクト構成

```
KAZIKASHIKA/
├── backend/          # バックエンドAPIサーバー
├── frontend/         # フロントエンドWebアプリケーション
├── infra/            # AWSインフラ (CDK)
├── docs/             # 設計ドキュメント
├── package.json      # ルートpackage.json (workspaces)
├── tsconfig.json     # 共通TypeScript設定
└── biome.json        # Biome設定
```

### セットアップ手順

#### 前提条件
- Node.js 20.x 以上
- npm 10.x 以上
- PostgreSQL 15.x (ローカル開発用)

#### 依存関係のインストール

```bash
# ルートディレクトリで実行
npm install

# または各ワークスペースで個別にインストール
cd backend && npm install
cd frontend && npm install
cd infra && npm install
```

#### バックエンド開発環境のセットアップ

```bash
cd backend

# 環境変数の設定
cp .env.example .env
# .envファイルを編集して、DATABASE_URLなどを設定

# Prismaクライアントの生成
npm run prisma:generate

# データベースマイグレーション
npm run prisma:migrate

# 開発サーバーの起動
npm run dev
```

#### フロントエンド開発環境のセットアップ

```bash
cd frontend

# 環境変数の設定
cp .env.example .env
# .envファイルを編集して、VITE_API_URLなどを設定

# 開発サーバーの起動
npm run dev
```

### 開発コマンド

```bash
# Lintの実行
npm run lint

# フォーマット
npm run format

# テストの実行
npm run test

# カバレッジ付きテスト
npm run test:coverage
```

### 関連ドキュメント

- [システムアーキテクチャ](./docs/architecture.md)
- [データベース設計](./docs/database-design.md)
- [インフラ構成図](./docs/infrastructure.drawio.svg)
- [実装計画](./.cursor_workflow/specs/implementations.md)
- [設計書](./.cursor_workflow/specs/design.md)

### コーディング規約

- [Google TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html) に準拠
- Biomeでの自動フォーマット・Lintを必須とする
- コミット前に `npm run lint` と `npm run format` を実行すること

### ライセンス

MIT