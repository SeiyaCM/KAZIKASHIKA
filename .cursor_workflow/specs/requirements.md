# 要件定義書

## 1. アプリの目的

### 1.1 プロダクトビジョン
家事の貢献度を可視化し、家庭内での公平な分担を促進するWebアプリケーション『KAZIKASHIKA』を提供する。
見えにくかった家事労働を定量的に評価し、メンバー間の相互理解とモチベーション向上を実現する。

### 1.2 解決する課題
- **家事労働の不可視性**: 家事の労力が見えにくく、貢献度が正当に評価されにくい
- **家事分担の不公平感**: 誰が何をどれだけやっているかが不明確で、不満が生じやすい
- **モチベーション不足**: 家事に対する達成感や継続的な動機づけが欠如している

### 1.3 提供価値
- 家事の時間と心理的負担（ストレス度）を掛け合わせたポイントシステムによる貢献度の可視化
- チーム内でのランキング表示によるゲーミフィケーション
- 客観的なデータに基づく公平な家事分担の実現

## 2. ターゲットユーザー

### 2.1 プライマリユーザー
- 家事分担に課題を感じている共働き夫婦・カップル

### 2.2 セカンダリユーザー
- 家族（子供含む）で家事への参加意識を高めたい家庭
- ルームシェア等、共同生活での家事分担ルールを明確にしたいグループ
- 一人暮らしで日々の家事に達成感やメリハリをつけたい個人

## 3. 機能要件

### 3.1 ユーザー登録とオンボーディング

#### FR-001: 新規ユーザー登録
- ユーザーはメールアドレスとパスワードで簡単にアカウントを登録できる
- ユーザー名を設定できる
- Amazon Cognito User Poolsを使用した認証を実装する

#### FR-002: チーム作成
- ユーザーはチームを作成できる
- チーム名を設定できる
- チーム作成時に招待コードが自動生成される

#### FR-003: チーム参加
- ユーザーは招待コードを使用してチームに参加できる
- 1ユーザーは1チームのみに所属できる

#### FR-004: ストレス度の初期設定（かんたん家事ストレス診断）
- 新規ユーザーは基本的な家事（料理、掃除機がけ、お風呂掃除など）に対する個人的なストレス度を設定できる
- ストレス度は5段階（1:楽 〜 5:大変）で選択する
- システムは予め定義された基本家事リスト（10種類程度）を提供する

#### ユースケース: 新規ユーザーがオンボーディングを完了する
1. ユーザーがアプリに初めてアクセスする
2. メールアドレス、パスワード、ユーザー名を入力してアカウントを登録する
3. チームを作成（または招待コードを入力して参加）する
4. 「かんたん家事ストレス診断」が開始される
5. システムは基本家事を一つずつ提示する
6. ユーザーは各家事に対してストレス度を5段階で選択する
7. すべての基本家事の設定が完了すると、ホーム画面が表示される

### 3.2 家事リストの管理

#### FR-005: 家事リスト閲覧
- ユーザーはチームの家事リストを閲覧できる
- 各家事に対する自身のストレス度が表示される

#### FR-006: 家事の追加
- ユーザーは新しい家事をリストに追加できる
- 家事の名前を入力できる（最大100文字）
- 追加時に自身のストレス度（1〜5）を設定できる

#### FR-007: チーム内での家事情報共有
- 新しい家事が追加されると、チームの家事リストに追加される
- 他のチームメンバーには、新しい家事に対するストレス度設定の通知が送られる

#### FR-008: 家事の編集
- ユーザーは家事名を編集できる
- ユーザーは自身のストレス度を変更できる

#### ユースケース: ユーザーが新しい家事を追加する
1. ユーザーが「家事リスト管理」画面を開く
2. 「新しい家事を追加」ボタンをクリックする
3. 家事の名前（例: 「観葉植物の水やり」）を入力する
4. 自身のストレス度（1〜5）を設定して保存する
5. 新しい家事がチームの家事リストに追加される
6. 他のチームメンバーに通知が送られる

### 3.3 家事の実行記録

#### FR-009: 家事の完了記録
- ユーザーは完了した家事を記録できる
- 実行にかかった時間を入力できる（1〜999分）
- 時間の選択肢ボタン（15分、30分、45分など）と自由入力欄を提供する

#### FR-010: ポイント計算とフィードバック
- システムは記録された時間とストレス度に基づいてポイントを自動計算する
- 計算式: 獲得ポイント = 家事の実行時間（分） × 個人設定のストレス度
- 記録完了時に獲得ポイントをフィードバック表示する

#### FR-011: ポイントの累積管理
- ユーザーの合計ポイントが自動的に更新される
- 記録履歴が保存される（実行日時、家事名、実行時間、獲得ポイント）

#### ユースケース: ユーザーが完了した家事を記録する
1. ユーザーがホーム画面の家事リストを見る
2. 完了した家事（例: 「お風呂掃除」）の「完了」ボタンをタップする
3. 「かかった時間は？」というモーダルが表示される
4. 時間の選択肢ボタンまたは自由入力欄が表示される
5. ユーザーが時間を入力（または選択）して「決定」ボタンをタップする
6. システムはポイントを計算し、「お疲れ様でした！XXポイント獲得です！」というフィードバックを表示する
7. ユーザーの合計ポイントが更新される

### 3.4 ダッシュボードとランキング

#### FR-012: 貢献度グラフ表示
- ユーザーはチーム内での各メンバーの家事貢献度を円グラフで確認できる
- 期間（今週、今月）を選択できる
- 選択した期間における各メンバーの合計獲得ポイントの割合が表示される

#### FR-013: ランキング表示
- ポイントに基づいたチーム内ランキングをリスト形式で表示する
- 各メンバーの合計ポイントと順位が表示される
- 期間（今週、今月）でフィルタリングできる

#### ユースケース: ユーザーがダッシュボードを確認する
1. ユーザーがダッシュボード画面を開く
2. 期間（「今週」「今月」）を選択する
3. 選択した期間における各メンバーの合計獲得ポイントの割合が円グラフで表示される
4. メンバーごとのポイント獲得ランキングがリスト形式で表示される
5. ランキングには各メンバーの合計ポイントと順位が表示される

## 4. ビジネスロジック

### 4.1 ポイント計算ロジック

#### BR-001: 基本計算式
```
獲得ポイント = 家事の実行時間（分） × 個人設定のストレス度
```

#### BR-002: 変数定義
- **家事の実行時間**: ユーザーが自己申告する時間（単位: 分）。Integer型。範囲: 1〜999
- **個人設定のストレス度**: 家事ごと、かつユーザーごとに設定される1〜5の整数値。Integer型。

#### BR-003: 計算例
**「トイレ掃除」を実行した場合**

前提条件:
| 項目 | Aさん | Bさん |
| :--- | :---: | :---: |
| トイレ掃除のストレス度 | 5 | 2 |

実行記録: 10分

獲得ポイント:
- Aさんが実行した場合: 10分 × 5 = 50ポイント
- Bさんが実行した場合: 10分 × 2 = 20ポイント

### 4.2 ランキング集計ロジック

#### BR-004: ランキング計算
- チーム内の全メンバーの獲得ポイントを集計する
- 指定期間（今週、今月）内の記録のみを対象とする
- ポイントの降順でソートして順位を決定する

#### BR-005: 円グラフの割合計算
- チーム全体の合計ポイントを算出する
- 各メンバーのポイント ÷ チーム全体の合計ポイント × 100 で割合を計算する

### 4.3 期間定義

#### BR-006: 「今週」の定義
- 過去7日間（本日を含む）

#### BR-007: 「今月」の定義
- 当月1日から本日まで

## 5. 非機能要件

### 5.1 プラットフォーム要件
- **NFR-001**: レスポンシブデザインのWebアプリケーションとして提供する
- **NFR-002**: PC・スマートフォンのブラウザで利用可能であること
- **NFR-003**: モダンブラウザ（Chrome、Firefox、Safari、Edge）の最新版をサポートする

### 5.2 パフォーマンス要件
- **NFR-004**: ページ表示や操作は3秒以内に完了すること
- **NFR-005**: 家事の記録操作は1秒以内にレスポンスを返すこと
- **NFR-006**: 同時アクセスユーザー数100までスムーズに動作すること

### 5.3 セキュリティ要件
- **NFR-007**: ユーザーデータは安全に管理される
- **NFR-008**: チーム外のユーザーからデータを閲覧できないこと
- **NFR-009**: Amazon Cognito User Poolsを使用した認証機能を実装すること
- **NFR-010**: 通信はHTTPSで暗号化すること
- **NFR-011**: Cognitoがパスワードを安全に管理すること

### 5.4 可用性要件
- **NFR-012**: 金銭的なコスト削減を優先する
- **NFR-013**: サービスの稼働率は95%以上を目標とする（コスト優先のため100%は求めない）

### 5.5 保守性要件
- **NFR-014**: コードの保守性を考慮した設計とする
- **NFR-015**: TypeScriptで型安全性を確保する
- **NFR-016**: Google TypeScript Style Guideに準拠する

### 5.6 スケーラビリティ要件
- **NFR-017**: 初期は小規模（100ユーザー程度）を想定
- **NFR-018**: 将来的な拡張に対応可能なアーキテクチャを採用する

## 6. 制約条件

### 6.1 技術的制約
- **CON-001**: 言語はTypeScriptで統一する
- **CON-002**: ライブラリのバージョンはlatestを使用する
- **CON-003**: モノレポ構成を採用する（backend、frontend、infra）
- **CON-004**: クラウドネイティブでAWSでサービスを立ち上げる
- **CON-005**: tRPCを採用してスキーマをbackendとfrontendで共有する
- **CON-006**: パッケージ管理はnpmを採用する
- **CON-007**: Formatter/LinterはBiome.jsを採用する
- **CON-008**: Amazon Cognito User Poolsを認証に使用する
- **CON-009**: CI/CDはGitHub Actionsを採用して.github/workflowsにて実装する

### 6.2 バックエンド制約
- **CON-010**: フレームワークはExpressを採用する
- **CON-011**: フォルダ構成はトランザクションスクリプトとする
- **CON-012**: ORMはPrismaを採用する（リレーショナルデータベース使用時）

### 6.3 フロントエンド制約
- **CON-013**: フレームワークはReactを採用する
- **CON-014**: ビルドツールはViteを採用する
- **CON-015**: bulletproof-reactのアーキテクチャを採用する

### 6.4 コスト制約
- **CON-016**: 可用性よりも金銭的なコスト削減を優先する
- **CON-017**: AWS無料枠内での運用を優先的に検討する

### 6.5 テスト制約
- **CON-018**: カバレッジ基準は分岐網羅(Branch Coverage)(C1)を採用する
- **CON-019**: バックエンドのカバレッジは85%以上とする
- **CON-020**: フロントエンドのカバレッジは75%以上とする

### 6.6 スコープ制約
- **CON-021**: v1.0では以下の機能は対象外とする
  - 「ありがとう」機能
  - 目標設定機能
  - ゲーミフィケーション要素の拡充（称号、バッジシステム）
  - レポート機能（月次サマリー）

## 7. データモデル（概念レベル）

### 7.1 主要エンティティ

#### User（ユーザー）
- ユーザーID（Cognito Sub）
- ユーザー名
- メールアドレス（Cognitoが管理）
- 所属チームID
- 作成日時

#### Team（チーム）
- チームID
- チーム名
- 招待コード
- 作成日時

#### Chore（家事）
- 家事ID
- 家事名
- 所属チームID
- デフォルト家事フラグ
- 作成日時

#### UserChoreStress（ユーザー別家事ストレス度）
- レコードID
- ユーザーID
- 家事ID
- ストレス度（1〜5）
- 作成日時
- 更新日時

#### ChoreLog（家事実行記録）
- ログID
- ユーザーID
- 家事ID
- 実行時間（分）
- 獲得ポイント
- 実行日時
- 作成日時

### 7.2 エンティティ関係
- User N:1 Team（ユーザーは1つのチームに所属）
- Chore N:1 Team（家事は1つのチームに所属）
- UserChoreStress N:1 User（ユーザーごとに複数のストレス度設定）
- UserChoreStress N:1 Chore（家事ごとに複数のユーザーのストレス度設定）
- UserChoreStress: (User, Chore) の組み合わせは一意
- ChoreLog N:1 User（ユーザーごとに複数の実行記録）
- ChoreLog N:1 Chore（家事ごとに複数の実行記録）

## 8. 画面構成（概要）

### 8.1 認証関連
- ログイン画面
- 新規登録画面
- チーム作成/参加画面

### 8.2 オンボーディング
- かんたん家事ストレス診断画面

### 8.3 メイン機能
- ホーム画面（家事リスト表示・記録）
- 家事リスト管理画面（追加・編集）
- ダッシュボード画面（貢献度グラフ・ランキング）

### 8.4 設定
- ユーザー設定画面
- チーム設定画面

## 9. 今後の拡張予定（v1.1以降）

### 9.1 v1.1での追加検討機能
- 「ありがとう」機能（感謝の気持ちをポイントとは別に送り合える）
- 目標設定機能（チームや個人で月間目標ポイントを設定）
- ゲーミフィケーション要素の拡充（称号、バッジシステム）
- レポート機能（月次でのサマリーレポートを自動生成）

## 10. 成功指標（KPI）

### 10.1 利用継続率
- 1ヶ月後の継続利用率：50%以上
- 3ヶ月後の継続利用率：30%以上

### 10.2 ユーザーエンゲージメント
- 週あたりの平均家事記録回数：5回以上/ユーザー
- チーム内での複数メンバー利用率：60%以上

### 10.3 ユーザー満足度
- ユーザーアンケートでの満足度：4.0以上/5.0点満点

## 11. リスク管理

### 11.1 技術的リスク
- **RISK-001**: AWSのコスト超過
  - 対策: 定期的なコストモニタリング、アラート設定
- **RISK-002**: パフォーマンス劣化
  - 対策: 初期段階での負荷テスト実施
- **RISK-003**: Cognito統合の複雑性
  - 対策: 早期にプロトタイプで検証

### 11.2 運用リスク
- **RISK-004**: セキュリティインシデント
  - 対策: セキュリティベストプラクティスの遵守、定期的なセキュリティレビュー

### 11.3 ビジネスリスク
- **RISK-005**: ユーザー獲得の困難
  - 対策: MVP（最小限の機能）での早期リリース、フィードバック収集

## 12. デフォルト家事リスト

システムが提供する基本家事リスト（オンボーディング時に使用）:

1. 料理
2. 食器洗い
3. 掃除機がけ
4. お風呂掃除
5. トイレ掃除
6. 洗濯
7. 洗濯物を干す
8. 洗濯物を畳む
9. ゴミ出し
10. 買い物

チーム作成時に、これらの家事が自動的にチームの家事リストに追加される。